@using Microsoft.AspNetCore.Components.Forms
@inject IJSRuntime JS

<div class="upload-section">
    <div class="upload-container">
        <div class="upload-box @(isDragOver ? "dragover" : "")"
             @ondragenter="HandleDragEnter"
             @ondragleave="HandleDragLeave"
             @ondragover:preventDefault
             @ondrop="HandleDrop"
             @ondrop:preventDefault
             @onclick="TriggerFileInput">
            
            <div class="upload-icon">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <h2>Arrastra archivos aquí</h2>
            <p>o haz clic para seleccionar</p>
            
            <InputFile id="fileInputHidden"
                       @ref="fileInput" 
                       OnChange="HandleFileSelected" 
                       accept=".pdf,.jpg,.jpeg,.png,.gif,.webp"
                       style="display: none;" />
            
            <div class="mode-selector">
                <label class="mode-option">
                    <input type="radio" name="mode" value="DOCUMENT" 
                           checked="@(selectedMode == JobMode.DOCUMENT)"
                           @onchange="() => selectedMode = JobMode.DOCUMENT" />
                    <span class="mode-label">
                        <i class="fas fa-file-invoice"></i>
                        Documento
                    </span>
                </label>
                <label class="mode-option">
                    <input type="radio" name="mode" value="DESIGN"
                           checked="@(selectedMode == JobMode.DESIGN)"
                           @onchange="() => selectedMode = JobMode.DESIGN" />
                    <span class="mode-label">
                        <i class="fas fa-tshirt"></i>
                        Diseño
                    </span>
                </label>
            </div>
        </div>
        
        <div class="upload-info">
            <p><strong>DOCUMENT:</strong> Facturas, órdenes, recibos → JSON estructurado</p>
            <p><strong>DESIGN:</strong> Imágenes de prendas con anotaciones → Cambios sugeridos</p>
        </div>
    </div>
</div>

@code {
    [Parameter] public EventCallback<(IBrowserFile File, JobMode Mode)> OnFileUploaded { get; set; }

    private InputFile? fileInput;
    private bool isDragOver;
    private JobMode selectedMode = JobMode.DOCUMENT;

    private void HandleDragEnter() => isDragOver = true;
    private void HandleDragLeave() => isDragOver = false;

    private async Task HandleDrop(DragEventArgs e)
    {
        isDragOver = false;
        // Note: Blazor doesn't support drag-drop file access directly
        // User needs to click to select files
    }

    private async Task TriggerFileInput()
    {
        // Disparar el input de archivo oculto mediante JS
        await JS.InvokeVoidAsync("filesToData.triggerFileInput", "fileInputHidden");
    }

    private async Task HandleFileSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;
        if (file != null)
        {
            await OnFileUploaded.InvokeAsync((file, selectedMode));
        }
    }
}
