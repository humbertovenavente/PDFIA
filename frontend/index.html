<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FilesToData Pro - Document Intelligence</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="styles.css?v=20251217-2" />
</head>
<body>
    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <div class="brand-icon">
                    <i class="fas fa-file-invoice"></i>
                </div>
                <div class="brand-text">
                    <span class="brand-name">FilesToData</span>
                    <span class="brand-version">Pro v3.0</span>
                </div>
            </div>
            
            <div class="sidebar-header">
                <button id="btn-new-job" class="btn-primary full">
                    <i class="fas fa-plus"></i>
                    <span>New Document</span>
                </button>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <h4 class="nav-title">Recent Jobs</h4>
                    <div id="jobs-list" class="jobs-list">
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <p>No jobs yet</p>
                        </div>
                    </div>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div id="status-indicator" class="status-badge status-unknown">
                    <span class="status-dot"></span>
                    <span class="status-text">Connecting...</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <header class="main-header">
                <div class="header-left">
                    <h1 class="page-title">Document Intelligence</h1>
                    <p class="page-subtitle">Extract structured data from your documents</p>
                </div>
                <div class="header-right">
                </div>
            </header>

            <section class="main-content">
                <!-- Upload Section -->
                <section id="upload-section" class="upload-section">
                    <div class="upload-card" id="upload-box">
                        <div class="upload-visual">
                            <div class="upload-icon-wrapper">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <div class="upload-icon-bg"></div>
                            </div>
                        </div>
                        <div class="upload-content">
                            <h2>Drag and drop your file here</h2>
                            <p>or click to browse</p>
                            <span class="upload-formats">PDF, JPG, PNG, WEBP</span>
                        </div>

                        <div class="mode-selector">
                            <button id="btn-mode-document" class="mode-btn active" data-mode="DOCUMENT">
                                <div class="mode-icon"><i class="fas fa-file-alt"></i></div>
                                <div class="mode-info">
                                    <span class="mode-name">Document</span>
                                    <span class="mode-desc">Invoices, orders, receipts</span>
                                </div>
                            </button>
                            <button id="btn-mode-design" class="mode-btn" data-mode="DESIGN">
                                <div class="mode-icon"><i class="fas fa-tshirt"></i></div>
                                <div class="mode-info">
                                    <span class="mode-name">Design</span>
                                    <span class="mode-desc">Images with annotations</span>
                                </div>
                            </button>
                        </div>

                        <input type="file" id="file-input" accept=".pdf,.jpg,.jpeg,.png,.gif,.webp" hidden />
                    </div>

                    
                </section>

                <!-- Detail Section -->
                <section id="detail-section" class="detail-section hidden">
                    <div class="detail-header">
                        <div class="detail-info">
                            <div class="file-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <div class="file-details">
                                <h2 id="detail-file-name">No file selected</h2>
                                <p id="detail-meta" class="file-meta"></p>
                            </div>
                        </div>
                        <div class="detail-actions">
                        </div>
                    </div>

                    <!-- Processing overlay removed - now using incremental editing -->

                    <!-- Tab Navigation removed - Editor is the only view -->
                    <div class="detail-tabs hidden" id="detail-tabs">
                    </div>

                    <div class="detail-body">
                        <!-- Editor Tab (Combined PDF + Editable Content) -->
                        <div class="tab-content active" id="tab-editor">
                            <div id="template-view" class="hidden"></div>
                            <div class="editor-container">
                                <!-- Left: PDF Viewer -->
                                <div class="editor-pdf-panel">
                                    <div class="editor-panel-header">
                                        <h4><i class="fas fa-file-pdf"></i> Source Document</h4>
                                        <div class="editor-pdf-controls">
                                            <button class="btn-tool btn-sm" id="btn-editor-zoom-out" title="Zoom Out">
                                                <i class="fas fa-search-minus"></i>
                                            </button>
                                            <span class="editor-zoom-level" id="editor-zoom-level">100%</span>
                                            <button class="btn-tool btn-sm" id="btn-editor-zoom-in" title="Zoom In">
                                                <i class="fas fa-search-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="editor-pdf-nav">
                                        <button class="btn-page" id="btn-editor-prev-page"><i class="fas fa-chevron-left"></i></button>
                                        <span class="page-indicator">Page <span id="editor-current-page">1</span> of <span id="editor-total-pages">1</span></span>
                                        <button class="btn-page" id="btn-editor-next-page"><i class="fas fa-chevron-right"></i></button>
                                    </div>
                                    <div class="editor-pdf-workspace">
                                        <div class="editor-canvas-wrapper" id="editor-canvas-wrapper">
                                            <canvas id="editor-pdf-canvas"></canvas>
                                            <canvas id="editor-annotation-canvas"></canvas>
                                            <canvas id="editor-overlay-canvas"></canvas>
                                            <div class="editor-loading hidden" id="editor-loading">
                                                <div class="spinner"></div>
                                                <span>Loading...</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="editor-pdf-actions">
                                        <div class="editor-extract-mode" role="group" aria-label="Extraction mode">
                                            <button class="mode-btn active" id="btn-mode-manual" type="button">Manual</button>
                                            <button class="mode-btn" id="btn-mode-auto" type="button">Auto</button>
                                        </div>
                                        <span class="editor-hint" id="editor-hint"><i class="fas fa-info-circle"></i> Draw a rectangle to select a region</span>
                                        <button class="btn-primary btn-sm hidden" id="btn-auto-scan" type="button">
                                            <i class="fas fa-magic"></i> Scan Page
                                        </button>
                                        <button class="btn-primary btn-sm" id="btn-editor-extract" disabled>
                                            <i class="fas fa-plus"></i> Add Selection
                                        </button>
                                    </div>
                                </div>

                                <!-- Right: Editable Content -->
                                <div class="editor-content-panel">
                                    <div class="editor-panel-header">
                                        <h4><i class="fas fa-list-alt"></i> Extracted Content</h4>
                                        <button class="btn-secondary btn-sm" id="btn-add-text-block">
                                            <i class="fas fa-plus"></i> Add Text
                                        </button>
                                    </div>
                                    <div class="auto-scan-panel hidden" id="auto-scan-panel">
                                        <div class="auto-scan-header">
                                            <div class="auto-scan-title">
                                                <i class="fas fa-magic"></i>
                                                <span>Auto Scan</span>
                                                <span class="auto-scan-sub">(Page <span id="auto-scan-page">1</span>)</span>
                                            </div>
                                            <div class="auto-scan-header-actions">
                                                <button class="btn-secondary btn-sm" id="btn-auto-select-all" type="button">Select All</button>
                                                <button class="btn-secondary btn-sm" id="btn-auto-select-none" type="button">None</button>
                                            </div>
                                        </div>
                                        <div class="auto-scan-list" id="auto-scan-list"></div>
                                        <div class="auto-scan-actions">
                                            <button class="btn-primary btn-sm" id="btn-auto-edit-selected" type="button">
                                                <i class="fas fa-edit"></i> Edit Selected
                                            </button>
                                        </div>
                                    </div>
                                    <div class="editor-content-list" id="editor-content-list">
                                        <div class="empty-state small">
                                            <i class="fas fa-mouse-pointer"></i>
                                            <p>Select regions from the PDF to extract content</p>
                                        </div>
                                    </div>
                                    <div class="editor-content-actions">
                                        <button class="btn-primary" id="btn-save-changes">
                                            <i class="fas fa-eye"></i> Preview Changes
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Legacy Document Tab (hidden) -->
                        <div class="tab-content hidden" id="tab-document">
                            <div class="document-viewer-container">
                                <div class="document-toolbar">
                                    <div class="doc-toolbar-left">
                                        <button class="btn-tool" id="btn-doc-zoom-out" title="Zoom Out">
                                            <i class="fas fa-search-minus"></i>
                                        </button>
                                        <span class="doc-zoom-level" id="doc-zoom-level">100%</span>
                                        <button class="btn-tool" id="btn-doc-zoom-in" title="Zoom In">
                                            <i class="fas fa-search-plus"></i>
                                        </button>
                                        <div class="toolbar-divider"></div>
                                        <button class="btn-tool" id="btn-doc-fit-width" title="Fit Width">
                                            <i class="fas fa-arrows-alt-h"></i>
                                        </button>
                                    </div>
                                    <div class="doc-toolbar-center">
                                        <button class="btn-page" id="btn-doc-prev-page"><i class="fas fa-chevron-left"></i></button>
                                        <span class="page-indicator">Page <span id="doc-current-page">1</span> of <span id="doc-total-pages">1</span></span>
                                        <button class="btn-page" id="btn-doc-next-page"><i class="fas fa-chevron-right"></i></button>
                                    </div>
                                    <div class="doc-toolbar-right">
                                        <button class="btn-tool active" id="btn-doc-select-mode" title="Select Region">
                                            <i class="fas fa-crop-alt"></i>
                                            <span>Select</span>
                                        </button>
                                        <button class="btn-tool" id="btn-doc-extract-region" disabled title="Extract Text from Selection">
                                            <i class="fas fa-file-export"></i>
                                            <span>Extract</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="document-workspace">
                                    <div class="document-canvas-wrapper" id="doc-canvas-wrapper">
                                        <canvas id="doc-pdf-canvas"></canvas>
                                        <canvas id="doc-overlay-canvas"></canvas>
                                        <div class="doc-loading hidden" id="doc-loading">
                                            <div class="spinner"></div>
                                            <span>Loading document...</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="document-extraction-panel hidden" id="doc-extraction-panel">
                                    <div class="extraction-panel-header">
                                        <h4><i class="fas fa-file-alt"></i> Extraction Results</h4>
                                        <button class="btn-close" id="btn-close-doc-extraction"><i class="fas fa-times"></i></button>
                                    </div>
                                    <div class="extraction-panel-body">
                                        <div class="extraction-content">
                                            <div class="extraction-image-section">
                                                <h5><i class="fas fa-image"></i> Cropped Image</h5>
                                                <div class="extraction-image-wrapper">
                                                    <img id="doc-extracted-image" alt="Cropped region" />
                                                </div>
                                                <button class="btn-secondary btn-sm" id="btn-download-doc-image">
                                                    <i class="fas fa-download"></i> Download Image
                                                </button>
                                            </div>
                                            <div class="extraction-text-section">
                                                <h5><i class="fas fa-font"></i> Extracted Text</h5>
                                                <pre id="doc-extracted-text"></pre>
                                            </div>
                                        </div>
                                        <div class="extraction-tables-section hidden" id="doc-tables-section">
                                            <h5><i class="fas fa-table"></i> Extracted Tables</h5>
                                            <div id="doc-extracted-tables"></div>
                                        </div>
                                    </div>
                                    <div class="extraction-panel-actions">
                                        <button class="btn-secondary" id="btn-copy-doc-text">
                                            <i class="fas fa-copy"></i> Copy Text
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- PDF Regions Tab (Hidden - functionality moved to Editor Auto mode) -->
                        <div class="tab-content hidden" id="tab-pdf-regions">
                        </div>

                    </div>
                </section>
            </section>
        </main>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <!-- PDF Preview Modal -->
    <div id="pdf-preview-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closePdfPreviewModal()"></div>
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-file-pdf"></i> Modified Document Preview</h3>
                <div class="modal-header-actions">
                    <button class="btn-secondary btn-sm" onclick="openPdfPreviewInNewTab()">
                        <i class="fas fa-external-link-alt"></i> Open
                    </button>
                    <button class="btn-close" onclick="closePdfPreviewModal()"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div class="modal-body">
                <iframe id="pdf-preview-iframe" class="pdf-preview-iframe"></iframe>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closePdfPreviewModal()">Close</button>
                <button class="btn-secondary" onclick="downloadModifiedPdf()">
                    <i class="fas fa-download"></i> Download
                </button>
                <button class="btn-primary" id="btn-modal-save-changes" onclick="saveChangesPersistently()">
                    <i class="fas fa-save"></i> Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs@4.4.0/dist/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <script src="templateDefinitions.js?v=20251216-8"></script>
    <script src="exportExcel.js?v=20251216-8"></script>
    <script src="app.js?v=20251217-2"></script>
    <script src="pdfRegions.js?v=20251216-8"></script>
    <script src="documentViewer.js?v=20251216-8"></script>
    <script src="documentEditor.js?v=20251216-8"></script>
</body>
</html>
